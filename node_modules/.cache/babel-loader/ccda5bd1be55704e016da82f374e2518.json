{"ast":null,"code":"import _objectSpread from \"D:\\\\testAI\\\\bnk48-face-recognition-master\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread\";\nimport _regeneratorRuntime from \"D:\\\\testAI\\\\bnk48-face-recognition-master\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _asyncToGenerator from \"D:\\\\testAI\\\\bnk48-face-recognition-master\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"D:\\\\testAI\\\\bnk48-face-recognition-master\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";\nimport _classCallCheck from \"D:\\\\testAI\\\\bnk48-face-recognition-master\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"D:\\\\testAI\\\\bnk48-face-recognition-master\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"D:\\\\testAI\\\\bnk48-face-recognition-master\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"D:\\\\testAI\\\\bnk48-face-recognition-master\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"D:\\\\testAI\\\\bnk48-face-recognition-master\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"D:\\\\testAI\\\\bnk48-face-recognition-master\\\\src\\\\views\\\\faceRecognition.js\";\nimport React, { Component } from 'react';\nimport { withRouter } from 'react-router-dom';\nimport { loadModels, getFullFaceDescription, createMatcher, isFaceDetectionModelLoaded } from '../api/face';\nimport DrawBox from '../components/drawBox';\nimport ShowDescriptors from '../components/showDescriptors';\nimport { JSON_PROFILE } from '../common/profile';\nvar MaxWidth = 600;\nvar boxColor = '#BE80B5';\nvar INIT_STATE = {\n  url: null,\n  imageURL: null,\n  fullDesc: null,\n  imageDimension: null,\n  error: null,\n  loading: false\n};\n\nvar FaceRecognition =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(FaceRecognition, _Component);\n\n  function FaceRecognition(props) {\n    var _this;\n\n    _classCallCheck(this, FaceRecognition);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(FaceRecognition).call(this, props));\n\n    _this.changeInput = function (event) {\n      var target = event.target;\n      var name = target.name;\n      var value = target.value; // const descriptor = target.descriptor\n\n      _this.setState(_defineProperty({}, name, value));\n    };\n\n    _this.submitForm = function (event) {\n      event.preventDefault();\n      var _this$state = _this.state,\n          txtName = _this$state.txtName,\n          txtAge = _this$state.txtAge;\n      var item = {};\n      item.name = txtName + ' - ' + txtAge; // item.descriptors = \n\n      console.log(item);\n      var json = JSON.parse('<json string>');\n      var data = JSON.stringify(json);\n\n      var fs = require('fs');\n\n      fs.writeFile(\"../descriptors/bnk48.json\", data);\n    };\n\n    _this.mounting =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return loadModels();\n\n            case 2:\n              _context.next = 4;\n              return _this.matcher();\n\n            case 4:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, this);\n    }));\n    _this.matcher =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee2() {\n      var faceMatcher;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return createMatcher(JSON_PROFILE);\n\n            case 2:\n              faceMatcher = _context2.sent;\n\n              _this.setState({\n                faceMatcher: faceMatcher\n              });\n\n            case 4:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, this);\n    }));\n\n    _this.handleFileChange =\n    /*#__PURE__*/\n    function () {\n      var _ref3 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee3(event) {\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _this.resetState();\n\n                _context3.next = 3;\n                return _this.setState({\n                  imageURL: URL.createObjectURL(event.target.files[0]),\n                  loading: true\n                });\n\n              case 3:\n                _this.handleImageChange();\n\n              case 4:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      return function (_x) {\n        return _ref3.apply(this, arguments);\n      };\n    }();\n\n    _this.handleURLChange = function (event) {\n      _this.setState({\n        url: event.target.value\n      });\n    };\n\n    _this.handleButtonClick =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee4() {\n      var blob;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _this.resetState();\n\n              _context4.next = 3;\n              return fetch(_this.state.url).then(function (r) {\n                return r.blob();\n              }).catch(function (error) {\n                return _this.setState({\n                  error: error\n                });\n              });\n\n            case 3:\n              blob = _context4.sent;\n\n              if (!!blob && blob.type.includes('image')) {\n                _this.setState({\n                  imageURL: URL.createObjectURL(blob),\n                  loading: true\n                });\n\n                _this.handleImageChange();\n              }\n\n            case 5:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4, this);\n    }));\n    _this.handleImageChange =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee5() {\n      var image,\n          _args5 = arguments;\n      return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              image = _args5.length > 0 && _args5[0] !== undefined ? _args5[0] : _this.state.imageURL;\n              _context5.next = 3;\n              return _this.getImageDimension(image);\n\n            case 3:\n              _context5.next = 5;\n              return getFullFaceDescription(image).then(function (fullDesc) {\n                _this.setState({\n                  fullDesc: fullDesc,\n                  loading: false\n                });\n              });\n\n            case 5:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5, this);\n    }));\n\n    _this.getImageDimension = function (imageURL) {\n      var img = new Image();\n\n      img.onload = function () {\n        var HEIGHT = _this.state.WIDTH * img.height / img.width;\n\n        _this.setState({\n          HEIGHT: HEIGHT,\n          imageDimension: {\n            width: img.width,\n            height: img.height\n          }\n        });\n      };\n\n      img.src = imageURL;\n    };\n\n    _this.handleDescriptorsCheck = function (event) {\n      _this.setState({\n        showDescriptors: event.target.checked\n      });\n    };\n\n    _this.resetState = function () {\n      _this.setState(_objectSpread({}, INIT_STATE));\n    };\n\n    _this.state = _objectSpread({}, INIT_STATE, {\n      faceMatcher: null,\n      showDescriptors: false,\n      WIDTH: null,\n      HEIGHT: 0,\n      isModelLoaded: !!isFaceDetectionModelLoaded(),\n      txtName: '',\n      txtAge: ''\n    });\n    return _this;\n  }\n\n  _createClass(FaceRecognition, [{\n    key: \"componentWillMount\",\n    value: function componentWillMount() {\n      this.resetState();\n      var _W = document.documentElement.clientWidth;\n      if (_W > MaxWidth) _W = MaxWidth;\n      this.setState({\n        WIDTH: _W\n      });\n      this.mounting();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$state2 = this.state,\n          WIDTH = _this$state2.WIDTH,\n          HEIGHT = _this$state2.HEIGHT,\n          imageURL = _this$state2.imageURL,\n          fullDesc = _this$state2.fullDesc,\n          faceMatcher = _this$state2.faceMatcher,\n          showDescriptors = _this$state2.showDescriptors,\n          isModelLoaded = _this$state2.isModelLoaded,\n          error = _this$state2.error,\n          loading = _this$state2.loading; // Display working status\n      // let status = <p>Status: Model Loaded = {isModelLoaded.toString()}</p>;\n      // if (!!error && error.toString() === 'TypeError: Failed to fetch') {\n      //   status = (\n      //     <p style={{ color: 'red' }}>Status: Error Failed to fetch Image URL</p>\n      //   );\n      // } else if (loading) {\n      //   status = <p style={{ color: 'blue' }}>Status: LOADING...</p>;\n      // } else if (!!fullDesc && !!imageURL && !loading) {\n      //   if (fullDesc.length < 2)\n      //     status = <p>Status: {fullDesc.length} Face Detect</p>;\n      //   if (fullDesc.length > 1)\n      //     status = <p>Status: {fullDesc.length} Faces Detect</p>;\n      // }\n      // Loading Spinner\n\n      var spinner = React.createElement(\"div\", {\n        style: {\n          margin: 0,\n          color: '#BE80B5',\n          position: 'absolute',\n          top: '50%',\n          left: '50%',\n          transform: 'translate(-50%,-50%)',\n          textShadow: '2px 2px 3px #fff'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 171\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"loading\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 182\n        },\n        __self: this\n      }), React.createElement(\"h3\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 183\n        },\n        __self: this\n      }, \"Processing...\"));\n      return React.createElement(\"div\", {\n        style: {\n          display: 'flex',\n          flexDirection: 'column',\n          alignItems: 'center'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 188\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        style: {\n          position: 'relative',\n          width: WIDTH,\n          height: HEIGHT\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 196\n        },\n        __self: this\n      }, !!imageURL ? React.createElement(\"div\", {\n        style: {\n          position: 'relative'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 204\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        style: {\n          position: 'absolute'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 209\n        },\n        __self: this\n      }, React.createElement(\"img\", {\n        style: {\n          width: WIDTH\n        },\n        src: imageURL,\n        alt: \"imageURL\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 210\n        },\n        __self: this\n      })), !!fullDesc ? React.createElement(DrawBox, {\n        fullDesc: fullDesc,\n        faceMatcher: faceMatcher,\n        imageWidth: WIDTH,\n        boxColor: boxColor,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 213\n        },\n        __self: this\n      }) : null) : null, loading ? spinner : null), React.createElement(\"form\", {\n        action: \"POST\",\n        onSubmit: function onSubmit(e) {\n          return _this2.submitForm(e);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 224\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        style: {\n          width: WIDTH,\n          padding: 10,\n          border: 'solid',\n          marginTop: 10\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 225\n        },\n        __self: this\n      }, React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 233\n        },\n        __self: this\n      }, \"Nh\\u1EADp t\\u1EADp tin h\\xECnh \\u1EA3nh ho\\u1EB7c URL\"), React.createElement(\"input\", {\n        id: \"myFileUpload\",\n        type: \"file\",\n        onChange: this.handleFileChange,\n        accept: \".jpg, .jpeg, .png\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 234\n        },\n        __self: this\n      }), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 240\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"URLInput\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 241\n        },\n        __self: this\n      }, React.createElement(\"input\", {\n        type: \"url\",\n        name: \"url\",\n        id: \"url\",\n        placeholder: \"Place your photo URL here (only .jpg, .jpeg, .png)\",\n        pattern: \"https://.*\",\n        size: \"30\",\n        onChange: this.handleURLChange,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 242\n        },\n        __self: this\n      }), React.createElement(\"button\", {\n        onClick: this.handleButtonClick,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 251\n        },\n        __self: this\n      }, \"Upload\")), React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 253\n        },\n        __self: this\n      }, React.createElement(\"input\", {\n        name: \"descriptors\",\n        type: \"checkbox\",\n        checked: this.state.showDescriptors,\n        onChange: this.handleDescriptorsCheck,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 254\n        },\n        __self: this\n      }), React.createElement(\"label\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 260\n        },\n        __self: this\n      }, \"Show Descriptors\")), React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 262\n        },\n        __self: this\n      }, React.createElement(\"input\", {\n        name: \"txtName\",\n        type: \"text\",\n        placeholder: \"Nh\\u1EADp t\\xEAn\",\n        value: this.state.txtName,\n        onChange: function onChange(e) {\n          return _this2.changeInput(e);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 263\n        },\n        __self: this\n      }), React.createElement(\"input\", {\n        name: \"txtAge\",\n        type: \"text\",\n        placeholder: \"Nh\\u1EADp tu\\u1ED5i\",\n        value: this.state.txtAge,\n        onChange: function onChange(e) {\n          return _this2.changeInput(e);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 264\n        },\n        __self: this\n      })), React.createElement(\"input\", {\n        type: \"submit\",\n        value: \"Submit\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 266\n        },\n        __self: this\n      }), !!showDescriptors ? React.createElement(ShowDescriptors, {\n        fullDesc: fullDesc,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 267\n        },\n        __self: this\n      }) : null)));\n    }\n  }]);\n\n  return FaceRecognition;\n}(Component);\n\nexport default withRouter(FaceRecognition);","map":{"version":3,"sources":["D:\\testAI\\bnk48-face-recognition-master\\src\\views\\faceRecognition.js"],"names":["React","Component","withRouter","loadModels","getFullFaceDescription","createMatcher","isFaceDetectionModelLoaded","DrawBox","ShowDescriptors","JSON_PROFILE","MaxWidth","boxColor","INIT_STATE","url","imageURL","fullDesc","imageDimension","error","loading","FaceRecognition","props","changeInput","event","target","name","value","setState","submitForm","preventDefault","state","txtName","txtAge","item","console","log","json","JSON","parse","data","stringify","fs","require","writeFile","mounting","matcher","faceMatcher","handleFileChange","resetState","URL","createObjectURL","files","handleImageChange","handleURLChange","handleButtonClick","fetch","then","r","blob","catch","type","includes","image","getImageDimension","img","Image","onload","HEIGHT","WIDTH","height","width","src","handleDescriptorsCheck","showDescriptors","checked","isModelLoaded","_W","document","documentElement","clientWidth","spinner","margin","color","position","top","left","transform","textShadow","display","flexDirection","alignItems","e","padding","border","marginTop"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { withRouter } from 'react-router-dom';\nimport {\n  loadModels,\n  getFullFaceDescription,\n  createMatcher,\n  isFaceDetectionModelLoaded\n} from '../api/face';\nimport DrawBox from '../components/drawBox';\nimport ShowDescriptors from '../components/showDescriptors';\nimport { JSON_PROFILE } from '../common/profile';\n\nconst MaxWidth = 600;\nconst boxColor = '#BE80B5';\n\n\n\nconst INIT_STATE = {\n  url: null,\n  imageURL: null,\n  fullDesc: null,\n  imageDimension: null,\n  error: null,\n  loading: false\n};\n\nclass FaceRecognition extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      ...INIT_STATE,\n      faceMatcher: null,\n      showDescriptors: false,\n      WIDTH: null,\n      HEIGHT: 0,\n      isModelLoaded: !!isFaceDetectionModelLoaded(),\n      txtName : '',\n      txtAge : ''\n    };\n  }\nchangeInput = (event) =>{\n  const target = event.target\n  const name = target.name\nconst value =target.value\n  // const descriptor = target.descriptor\n  this.setState({\n    [name] : value\n  });\n}\n\n  submitForm = (event) =>{\n    event.preventDefault();\n    const {txtName,txtAge} = this.state;\n    const item = {};\n    item.name =txtName+' - '+txtAge;\n    // item.descriptors = \n    console.log(item)\n    var json = JSON.parse('<json string>');\n    var data = JSON.stringify(json);\n    var fs = require('fs');\n    fs.writeFile(\"../descriptors/bnk48.json\", data);\n  }\n\n  componentWillMount() {\n    this.resetState();\n    let _W = document.documentElement.clientWidth;\n    if (_W > MaxWidth) _W = MaxWidth;\n    this.setState({ WIDTH: _W });\n    this.mounting();\n  }\n\n  mounting = async () => {\n    await loadModels();\n    await this.matcher();\n    // await this.getImageDimension(testImg);\n    // await this.setState({ imageURL: testImg, loading: true });\n    // await this.handleImageChange(testImg);\n  };\n\n  matcher = async () => {\n    const faceMatcher = await createMatcher(JSON_PROFILE);\n    this.setState({ faceMatcher });\n  };\n\n  handleFileChange = async event => {\n    this.resetState();\n    await this.setState({\n      imageURL: URL.createObjectURL(event.target.files[0]),\n      loading: true\n    });\n    this.handleImageChange();\n  };\n\n  handleURLChange = event => {\n    this.setState({ url: event.target.value });\n  };\n\n  handleButtonClick = async () => {\n    this.resetState();\n    let blob = await fetch(this.state.url)\n      .then(r => r.blob())\n      .catch(error => this.setState({ error }));\n    if (!!blob && blob.type.includes('image')) {\n      this.setState({\n        imageURL: URL.createObjectURL(blob),\n        loading: true\n      });\n      this.handleImageChange();\n    }\n  };\n\n  handleImageChange = async (image = this.state.imageURL) => {\n    await this.getImageDimension(image);\n    await getFullFaceDescription(image).then(fullDesc => {\n      this.setState({ fullDesc, loading: false });\n    });\n  };\n\n  getImageDimension = imageURL => {\n    let img = new Image();\n    img.onload = () => {\n      let HEIGHT = (this.state.WIDTH * img.height) / img.width;\n      this.setState({\n        HEIGHT,\n        imageDimension: {\n          width: img.width,\n          height: img.height\n        }\n      });\n    };\n    img.src = imageURL;\n  };\n\n  handleDescriptorsCheck = event => {\n    this.setState({ showDescriptors: event.target.checked });\n  };\n\n  resetState = () => {\n    this.setState({ ...INIT_STATE });\n  };\n  render() {\n    const {\n      WIDTH,\n      HEIGHT,\n      imageURL,\n      fullDesc,\n      faceMatcher,\n      showDescriptors,\n      isModelLoaded,\n      error,\n      loading\n    } = this.state;\n\n    // Display working status\n    // let status = <p>Status: Model Loaded = {isModelLoaded.toString()}</p>;\n    // if (!!error && error.toString() === 'TypeError: Failed to fetch') {\n    //   status = (\n    //     <p style={{ color: 'red' }}>Status: Error Failed to fetch Image URL</p>\n    //   );\n    // } else if (loading) {\n    //   status = <p style={{ color: 'blue' }}>Status: LOADING...</p>;\n    // } else if (!!fullDesc && !!imageURL && !loading) {\n    //   if (fullDesc.length < 2)\n    //     status = <p>Status: {fullDesc.length} Face Detect</p>;\n    //   if (fullDesc.length > 1)\n    //     status = <p>Status: {fullDesc.length} Faces Detect</p>;\n    // }\n\n    // Loading Spinner\n    let spinner = (\n      <div\n        style={{\n          margin: 0,\n          color: '#BE80B5',\n          position: 'absolute',\n          top: '50%',\n          left: '50%',\n          transform: 'translate(-50%,-50%)',\n          textShadow: '2px 2px 3px #fff'\n        }}\n      >\n        <div className=\"loading\" />\n        <h3>Processing...</h3>\n      </div>\n    );\n\n    return (\n      <div\n        style={{\n          display: 'flex',\n          flexDirection: 'column',\n          alignItems: 'center'\n        }}\n      >\n        {/* {status} */}\n        <div\n          style={{\n            position: 'relative',\n            width: WIDTH,\n            height: HEIGHT\n          }}\n        >\n          {!!imageURL ? (\n            <div\n              style={{\n                position: 'relative'\n              }}\n            >\n              <div style={{ position: 'absolute' }}>\n                <img style={{ width: WIDTH }} src={imageURL} alt=\"imageURL\" />\n              </div>\n              {!!fullDesc ? (\n                <DrawBox\n                  fullDesc={fullDesc}\n                  faceMatcher={faceMatcher}\n                  imageWidth={WIDTH}\n                  boxColor={boxColor}\n                />\n              ) : null}\n            </div>\n          ) : null}\n          {loading ? spinner : null}\n        </div>\n        <form action=\"POST\" onSubmit={(e)=> this.submitForm(e)}>\n        <div\n          style={{\n            width: WIDTH,\n            padding: 10,\n            border: 'solid',\n            marginTop: 10\n          }}\n        >\n          <p>Nhập tập tin hình ảnh hoặc URL</p>\n          <input\n            id=\"myFileUpload\"\n            type=\"file\"\n            onChange={this.handleFileChange}\n            accept=\".jpg, .jpeg, .png\"\n          />\n          <br />\n          <div className=\"URLInput\">\n            <input\n              type=\"url\"\n              name=\"url\"\n              id=\"url\"\n              placeholder=\"Place your photo URL here (only .jpg, .jpeg, .png)\"\n              pattern=\"https://.*\"\n              size=\"30\"\n              onChange={this.handleURLChange}\n            />\n            <button onClick={this.handleButtonClick}>Upload</button>\n          </div>\n          <div>\n            <input\n              name=\"descriptors\"\n              type=\"checkbox\"\n              checked={this.state.showDescriptors}\n              onChange={this.handleDescriptorsCheck}\n            />\n            <label>Show Descriptors</label>\n          </div>\n          <div>\n            <input name= \"txtName\" type=\"text\" placeholder=\"Nhập tên\" value ={this.state.txtName} onChange = { (e) => this.changeInput(e)}></input>\n            <input name= \"txtAge\" type=\"text\" placeholder=\"Nhập tuổi\" value ={this.state.txtAge} onChange = { (e) => this.changeInput(e)}></input>\n          </div>\n          <input type=\"submit\" value=\"Submit\"></input>\n          {!!showDescriptors ? <ShowDescriptors fullDesc={fullDesc} /> : null}\n        </div>\n        </form>\n      </div>\n    );\n  }\n}\n\nexport default withRouter(FaceRecognition);\n"]},"metadata":{},"sourceType":"module"}