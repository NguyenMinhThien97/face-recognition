{"ast":null,"code":"import * as tslib_1 from \"tslib\";\nimport * as tf from '@tensorflow/tfjs-core';\nimport { normalize } from 'tfjs-image-recognition-base';\nimport { depthwiseSeparableConv } from './depthwiseSeparableConv';\nimport { extractParamsTiny } from './extractParamsTiny';\nimport { FaceLandmark68NetBase } from './FaceLandmark68NetBase';\nimport { fullyConnectedLayer } from './fullyConnectedLayer';\nimport { extractParamsFromWeigthMapTiny } from './extractParamsFromWeigthMapTiny';\n\nfunction denseBlock(x, denseBlockParams, isFirstLayer) {\n  if (isFirstLayer === void 0) {\n    isFirstLayer = false;\n  }\n\n  return tf.tidy(function () {\n    var out1 = tf.relu(isFirstLayer ? tf.add(tf.conv2d(x, denseBlockParams.conv0.filters, [2, 2], 'same'), denseBlockParams.conv0.bias) : depthwiseSeparableConv(x, denseBlockParams.conv0, [2, 2]));\n    var out2 = depthwiseSeparableConv(out1, denseBlockParams.conv1, [1, 1]);\n    var in3 = tf.relu(tf.add(out1, out2));\n    var out3 = depthwiseSeparableConv(in3, denseBlockParams.conv2, [1, 1]);\n    return tf.relu(tf.add(out1, tf.add(out2, out3)));\n  });\n}\n\nvar FaceLandmark68TinyNet =\n/** @class */\nfunction (_super) {\n  tslib_1.__extends(FaceLandmark68TinyNet, _super);\n\n  function FaceLandmark68TinyNet() {\n    return _super.call(this, 'FaceLandmark68TinyNet') || this;\n  }\n\n  FaceLandmark68TinyNet.prototype.runNet = function (input) {\n    var params = this.params;\n\n    if (!params) {\n      throw new Error('FaceLandmark68TinyNet - load model before inference');\n    }\n\n    return tf.tidy(function () {\n      var batchTensor = input.toBatchTensor(112, true);\n      var meanRgb = [122.782, 117.001, 104.298];\n      var normalized = normalize(batchTensor, meanRgb).div(tf.scalar(255));\n      var out = denseBlock(normalized, params.dense0, true);\n      out = denseBlock(out, params.dense1);\n      out = denseBlock(out, params.dense2);\n      out = tf.avgPool(out, [14, 14], [2, 2], 'valid');\n      return fullyConnectedLayer(out.as2D(out.shape[0], -1), params.fc);\n    });\n  };\n\n  FaceLandmark68TinyNet.prototype.getDefaultModelName = function () {\n    return 'face_landmark_68_tiny_model';\n  };\n\n  FaceLandmark68TinyNet.prototype.extractParamsFromWeigthMap = function (weightMap) {\n    return extractParamsFromWeigthMapTiny(weightMap);\n  };\n\n  FaceLandmark68TinyNet.prototype.extractParams = function (weights) {\n    return extractParamsTiny(weights);\n  };\n\n  return FaceLandmark68TinyNet;\n}(FaceLandmark68NetBase);\n\nexport { FaceLandmark68TinyNet };","map":null,"metadata":{},"sourceType":"module"}